@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using CoffeeTunes.Frontend.Configs
@inject NavigationManager Navigation
@inject AuthConfig AuthConfig

<AuthorizeView>
    <Authorized>
        <div class="user-profile">
            <div class="user-name" @onclick="ToggleDropdown">
                <span class="user-icon">ðŸ‘¤</span>
                <span>@GetUserName(context)</span>
                <span class="dropdown-arrow">â–¼</span>
            </div>
            @if (showDropdown)
            {
                <div class="user-dropdown">
                    <button class="logout-button" @onclick="BeginLogout">
                        <span class="logout-icon">ðŸšª</span>
                        <span>Logout</span>
                    </button>
                </div>
            }
        </div>
    </Authorized>
</AuthorizeView>

@code {
    private bool showDropdown = false;

    private void ToggleDropdown()
    {
        showDropdown = !showDropdown;
    }

    private string GetUserName(AuthenticationState state)
    {
        var nameClaim = state.User.FindFirst(AuthConfig.NameClaimIdentifier);
        return nameClaim?.Value ?? "User";
    }

    private void BeginLogout()
    {
        Navigation.NavigateToLogout("authentication/logout");
    }
}
