@using CoffeeTunes.Contracts.BrewCycles

<div class="ingredient-display">
    <h3 class="ingredient-title">@Ingredient.Name</h3>
    <div class="ingredient-video">
        <iframe 
            src="@GetEmbedUrl(Ingredient.Url)" 
            title="@Ingredient.Name"
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen>
        </iframe>
    </div>
    <div class="ingredient-link">
        <a href="@Ingredient.Url" target="_blank" rel="noopener noreferrer" class="watch-link">
            <span>ðŸŽ¥</span>
            <span>Watch on YouTube</span>
        </a>
    </div>
</div>

@code {
    [Parameter]
    public required BrewCycleIngredientContract Ingredient { get; set; }
    
    private string GetEmbedUrl(string youtubeUrl)
    {
        try
        {
            // Convert YouTube watch URL to embed URL
            // https://www.youtube.com/watch?v=VIDEO_ID -> https://www.youtube.com/embed/VIDEO_ID
            var uri = new Uri(youtubeUrl);
            
            // Parse query string manually for Blazor WebAssembly compatibility
            var query = uri.Query.TrimStart('?');
            var videoId = query.Split('&')
                .Select(param => param.Split('='))
                .Where(parts => parts.Length == 2 && parts[0] == "v")
                .Select(parts => parts[1])
                .FirstOrDefault();
                
            if (string.IsNullOrEmpty(videoId))
            {
                // If no video ID found, return original URL
                return youtubeUrl;
            }
            
            return $"https://www.youtube.com/embed/{videoId}";
        }
        catch
        {
            // If URL parsing fails, return original URL
            return youtubeUrl;
        }
    }
}
